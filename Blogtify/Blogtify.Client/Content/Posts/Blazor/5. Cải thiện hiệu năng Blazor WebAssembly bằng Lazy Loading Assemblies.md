---
url: [/post/cai-thien-hieu-nang-blazor-webassembly-bang-lazy-loading-assemblies]
title: "Cải thiện hiệu năng Blazor WebAssembly bằng Lazy Loading Assemblies"
$attribute: PostMetadata(Id = 5, Title = "Cải thiện hiệu năng Blazor WebAssembly bằng Lazy Loading Assemblies", Category = "Blazor", LastModified = "19-10-2025")
$layout: BlogContentLayout
---

Blazor WebAssembly là một công nghệ mạnh mẽ cho phép bạn xây dựng ứng dụng web chạy 
hoàn toàn trong trình duyệt bằng C#. Tuy nhiên, vấn đề lớn nhất mà nhiều dev gặp phải 
là thời gian khi tải trang lần đầu quá lớn. 

Trong hướng dẫn này, chúng ta sẽ tìm hiểu cách triển khai Lazy Loading Assemblies để 
giảm kích thước gói tải ban đầu và chỉ tải thêm code khi người dùng thực sự cần. 

# Lazy Loading Assemblies là gì?

Lazy Loading là kỹ thuật trì hoãn việc tải một phần mã (assembly) cho đến khi người 
dùng điều hướng đến trang hoặc chức năng cần dùng phần đó. 

Ví dụ nếu website của bạn có một khu vực dành cho thành viên mà chỉ 5% người truy cập 
sử dụng, bạn không cần tải phần này ngay từ đầu. Thay vào đó, chỉ khi người dùng nhấn 
vào page có path là "members" thì ứng dụng mới tải thêm assembly chứa phần logic và giao diện đó. 

Kỹ thuật này giúp giảm thời gian tải ban đầu và cải thiện trải nghiệm người dùng đáng kể.

# Triển khai

**Bước 1: Tạo Razor Class Library cho phần cần Lazy Loading**

Để lazy load một phần của ứng dụng, ta cần tách riêng nó thành một Razor Class Library (RCL). 
Ví dụ tạo một RCL đặt tên là `BlazorWasmLazyLoading.Members`. 

Trong project này, thêm file Members.razor:
```markup
@page "/members"

<h1>Member Login</h1>

<input type="text" placeholder="Username" />
<input type="password" placeholder="Password" />
```

Đây là ví dụ đơn giản, bạn có thể đặt toàn bộ phần đăng nhập, quản lý tài khoản hoặc 
dashboard của thành viên trong project này. 

**Bước 2: Thêm Project Reference**

Mở file `BlazorWasmLazyLoading.csproj` và thêm project reference đến RCL vừa tạo:

```markup
<ItemGroup>
  <ProjectReference Include="..\BlazorWasmLazyLoading.Members\BlazorWasmLazyLoading.Members.csproj" />
</ItemGroup>
```

Rồi sau đó thêm thuộc tính `BlazorWebAssemblyLazyLoad`:

```markup
<ItemGroup>
  <BlazorWebAssemblyLazyLoad Include="BlazorWasmLazyLoading.Members.wasm" />
</ItemGroup>
```

Dòng này chỉ định rằng assembly này sẽ không được tải khi khởi động, mà chỉ tải khi được yêu cầu. 
Lưu ý: đừng quên đuôi `.wasm`, vì đây là dạng code biên dịch WebAssembly của thư viện.

**Bước 3: Cập nhật Router để hỗ trợ Lazy Loading**

Mở file `App.razor` và thêm nội dung như sau:

**Thêm namespace và inject các Service cần thiết:**
```markup
@using Microsoft.AspNetCore.Components.WebAssembly.Services
@using System.Reflection

@inject LazyAssemblyLoader AssemblyLoader
@inject ILogger<Program> Logger
```

**Cập nhật Router:**

```markup
<Router AppAssembly="@typeof(App).Assembly"
        AdditionalAssemblies="_lazyLoadedAssemblies"
        OnNavigateAsync="OnNavigateAsync">
    <Found Context="routeData">
        <RouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)" />
    </Found>
    <NotFound>
        <p>Sorry, page not found!</p>
    </NotFound>
</Router>

@code {
    private List<Assembly> _lazyLoadedAssemblies = new();

    private async Task OnNavigateAsync(NavigationContext context)
    {
        try
        {
            if (context.Path == "members")
            {
                var assemblies = await AssemblyLoader.LoadAssembliesAsync(new[]
                {
                    "BlazorWasmLazyLoading.Members.wasm"
                });
                _lazyLoadedAssemblies.AddRange(assemblies);
            }
        }
        catch (Exception ex)
        {
            Logger.LogError("Error loading assembly: {Message}", ex.Message);
        }
    }
}
```

Trong đoạn code này:
- `OnNavigateAsync` được gọi mỗi khi người dùng chuyển trang.
- Khi người dùng truy cập /members, ứng dụng sẽ:
    - Gọi `AssemblyLoader.LoadAssembliesAsync()` để tải file `.wasm` tương ứng.
    - Thêm assembly vừa tải vào `_lazyLoadedAssemblies` để Router có thể sử dụng.

Sau khi đã hoàn thành các bước trên, kiểm tra Lazy Loading đã hoạt động chưa bằng cách 
chạy ứng dụng sau đó mở DevTools trong trình duyệt và chuyển sang Network tab. 

Làm mới trang Home (/), bạn sẽ thấy chưa có file `BlazorWasmLazyLoading.Members.wasm` được tải. 
Rồi nhấp vào liên kết /members thì file `.wasm` sẽ được tải xuống và trang Members hiển thị.


Vậy là nhờ áp dụng Lazy Loading Assemblies, ứng dụng Blazor WebAssembly của bạn có thể 
đạt hiệu năng tốt hơn đáng kể. Thay vì tải toàn bộ mã ngay từ đầu, bạn chỉ cần tải những 
phần thực sự cần thiết giúp rút ngắn thời gian khởi động, giảm dung lượng tải xuống 
và mang lại trải nghiệm mượt mà hơn cho người dùng. Bên cạnh đó, việc chia nhỏ ứng dụng 
thành nhiều Razor Class Library cũng giúp bạn dễ dàng mở rộng và bảo trì code hơn 
trong tương lai.



